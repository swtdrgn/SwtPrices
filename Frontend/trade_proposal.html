<?

require("include/template.php");
if( is_auth(true) ){}

?>
<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->
<html>
	<head>
	<? include_meta_content(); ?>
	<script src="/include/trade.js"></script>
	
	<style>
		.game_result{
			background-color: #E0E0E0;
			border: 2px solid black;
			border-radius: 15px;
			-moz-border-radius: 15px;
			-webkit-border-radius: 15px;
			margin: 10px 2.5px 0px 2.5px;
			padding: 5px;
			text-align: center;
			cursor:pointer;
			display:table-cell;
			vertical-align:middle;
			width:250px;
			height: 150px;
		}
		
		.game_result img{
			width: 250px;
		}
		
		a.selection1{
			display: block;
			border-radius: 15px;
			-moz-border-radius: 15px;
			-webkit-border-radius: 15px;
			padding-right: 10px;
			cursor:pointer;
		}

		a.selection1:hover{
			background-color:red;
		}
		
		.selection2{
			display: block;
			border-radius: 0px;
			-moz-border-radius: 0px;
			-webkit-border-radius: 0px;
			padding-right: 10px;
			background-color:green;
			cursor: default;
		}
		
		#search_item{
			text-align: center;
		}
	</style>
	
	<body>
	<? include_body_header(); ?>
	
	
	
	<div class="results_container" style="padding-bottom: 20px;">
	<h3 style="margin-bottom: 10px;">Have Offers</h3>
	<div style="overflow-x: scroll; min-height: 150px; border-spacing: 10px;">
	<center id="trade_table">
<?php
	
	//$timeout = "index.html";
	//$context = stream_context_create(array('http' => array('timeout' => $timeout)));
	//$file = file_get_contents("http://steamcommunity.com/profiles/" . $_SESSION["steam64"] . "/?xml=1", false, $context);
	$file = @file_get_contents( "http://steamcommunity.com/profiles/" . $_SESSION["steam64"] . "/?xml=1" );
	$i=0;
	for($i=0; !$file && $i<10 ;$i++){
		$file = @file_get_contents( "http://steamcommunity.com/profiles/" . $_SESSION["steam64"] . "/?xml=1" );
	}
	$profile_page = false;
	if( $i==10 ){
		echo "Cannot connect to Steam's community pages.";
	}
	else{
		$profile_page = @simplexml_load_string($file);
	}
	
	//echo $file . "<br/><br/>";
	
	
	//$profile_page = simplexml_load_file( "http://steamcommunity.com/profiles/" . $_SESSION["steam64"] . "/?xml=1" );
	
	$inv_list = ""; $coupon_list = ""; $tf2 = ""; $sk = ""; $portal = "";
	$i = 0;
	
	if( @$profile_page ){
	
		if( strlen($profile_page->customURL) == 0 ){
			$inv_url = "http://steamcommunity.com/profiles/" . $_SESSION["steam64"];
		}
		else{
			$inv_url = "http://steamcommunity.com/id/" . $profile_page->customURL;
		}
			
		$game_inv_stream = file_get_contents( $inv_url . "/inventory/json/753/1");
		$game_inv = json_decode($game_inv_stream);
		
		if( $game_inv->{"success"} == true ){
			//print_r($game_inv->{"rgInventory"});
			
			foreach( $game_inv->{"rgInventory"} as $game ){
				//print_r($game);
				//echo "<br/>";
				$meta_data = $game->classid . "_" . $game->instanceid;
				$amount = $game->amount;
				//$game_inv->rgDescriptions->{$meta_data};
				$md = $game_inv->rgDescriptions->{$meta_data};
				$name = $md->name;
				$icon_url = $md->icon_url;
				$item_type = $md->type;
				//print_r($game_inv->rgDescriptions->{$meta_data});
				$j = 0;
				if( $md->tradable ){
					while( $j<$amount ){
						$inv_list .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . '</a>';
						//echo '<div class="game_result"><img src="http://cdn.steamcommunity.com/economy/image/' . $icon_url . '" /></div>';
						$j++;
						$i++;
					}
				}
			}
		}
	}
	else{
		echo "false!";
		print_r($_SESSION);
	}
	
	if( @$profile_page ){
	
		if( strlen($profile_page->customURL) == 0 ){
			$inv_url = "http://steamcommunity.com/profiles/" . $_SESSION["steam64"];
		}
		else{
			$inv_url = "http://steamcommunity.com/id/" . $profile_page->customURL;
		}
			
		$game_inv_stream = file_get_contents( $inv_url . "/inventory/json/753/3");
		$game_inv = json_decode($game_inv_stream);
		
		if( $game_inv->{"success"} == true ){
			//print_r($game_inv->{"rgInventory"});
			foreach( $game_inv->{"rgInventory"} as $game ){
				//print_r($game);
				//echo "<br/>";
				$meta_data = $game->classid . "_" . $game->instanceid;
				$amount = $game->amount;
				//$game_inv->rgDescriptions->{$meta_data};
				$md = $game_inv->rgDescriptions->{$meta_data};
				$name = $md->name;
				$icon_url = $md->icon_url;
				$item_type = $md->type;
				//print_r($game_inv->rgDescriptions->{$meta_data});
				$j = 0;
				if( $md->tradable ){
					while( $j<$amount ){
						$coupon_list .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . '</a>';
						//echo '<div class="game_result"><img src="http://cdn.steamcommunity.com/economy/image/' . $icon_url . '" /></div>';
						$j++;
						$i++;
					}
				}
			}
			//echo $game_inv[0];
		}
	}
	else{
		echo "false!";
		print_r($_SESSION);
	}
	
	if( @$profile_page ){
	
		if( strlen($profile_page->customURL) == 0 ){
			$inv_url = "http://steamcommunity.com/profiles/" . $_SESSION["steam64"];
		}
		else{
			$inv_url = "http://steamcommunity.com/id/" . $profile_page->customURL;
		}
			
		$game_inv_stream = file_get_contents( $inv_url . "/inventory/json/440/2");
		$game_inv = json_decode($game_inv_stream);
		
		if( $game_inv->{"success"} == true ){
			//print_r($game_inv->{"rgInventory"});
			foreach( $game_inv->{"rgInventory"} as $game ){
				//print_r($game);
				//echo "<br/>";
				$meta_data = $game->classid . "_" . $game->instanceid;
				$amount = $game->amount;
				//$game_inv->rgDescriptions->{$meta_data};
				$md = $game_inv->rgDescriptions->{$meta_data};
				$name = $md->name;
				$icon_url = $md->icon_url;
				$item_type = $md->type;
				//print_r($game_inv->rgDescriptions->{$meta_data});
				$j = 0;
				if( $md->tradable ){
					while( $j<$amount ){
						$tf2 .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . '</a>';
						//echo '<div class="game_result"><img src="http://cdn.steamcommunity.com/economy/image/' . $icon_url . '" /></div>';
						$j++;
						$i++;
					}
				}
			}
			//echo $game_inv[0];
		}
	}
	else{
		echo "false!";
		print_r($_SESSION);
	}
	
	if( @$profile_page ){
	
		if( strlen($profile_page->customURL) == 0 ){
			$inv_url = "http://steamcommunity.com/profiles/" . $_SESSION["steam64"];
		}
		else{
			$inv_url = "http://steamcommunity.com/id/" . $profile_page->customURL;
		}
			
		$game_inv_stream = file_get_contents( $inv_url . "/inventory/json/99900/2417929");
		$game_inv = json_decode($game_inv_stream);
		
		if( $game_inv->{"success"} == true ){
			//print_r($game_inv->{"rgInventory"});
			foreach( $game_inv->{"rgInventory"} as $game ){
				//print_r($game);
				//echo "<br/>";
				$meta_data = $game->classid . "_" . $game->instanceid;
				$amount = $game->amount;
				//$game_inv->rgDescriptions->{$meta_data};
				$md = $game_inv->rgDescriptions->{$meta_data};
				$name = $md->name;
				$icon_url = $md->icon_url;
				$item_type = $md->type;
				//print_r($game_inv->rgDescriptions->{$meta_data});
				$j = 0;
				if( $md->tradable ){
					//while( $j<$amount ){
					if( $amount > 1 ){
						$sk .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . ' (' . $amount . 'x) </a>';
					}
					else{
						$sk .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . '</a>';
					}
						//echo '<div class="game_result"><img src="http://cdn.steamcommunity.com/economy/image/' . $icon_url . '" /></div>';
						$j++;
						$i++;
					//}
				}
			}
			//echo $game_inv[0];
		}
	}
	else{
		echo "false!";
		print_r($_SESSION);
	}
		
		
	if( @$profile_page ){
	
		if( strlen($profile_page->customURL) == 0 ){
			$inv_url = "http://steamcommunity.com/profiles/" . $_SESSION["steam64"];
		}
		else{
			$inv_url = "http://steamcommunity.com/id/" . $profile_page->customURL;
		}
			
		$game_inv_stream = file_get_contents( $inv_url . "/inventory/json/620/2");
		$game_inv = json_decode($game_inv_stream);
		
		if( $game_inv->{"success"} == true ){
			//print_r($game_inv->{"rgInventory"});
			foreach( $game_inv->{"rgInventory"} as $game ){
				//print_r($game);
				//echo "<br/>";
				$meta_data = $game->classid . "_" . $game->instanceid;
				$amount = $game->amount;
				//$game_inv->rgDescriptions->{$meta_data};
				$md = $game_inv->rgDescriptions->{$meta_data};
				$name = $md->name;
				$icon_url = $md->icon_url;
				$item_type = $md->type;
				//print_r($game_inv->rgDescriptions->{$meta_data});
				$j = 0;
				if( $md->tradable ){
					while( $j<$amount ){
						$portal .= '<a id="' . $i . '" class="selection1" onClick="create_item(this,\'' . urlencode($name) . '\',\'' . $icon_url . '\',\'' . $item_type . '\');">' . $name . '</a>';
						//echo '<div class="game_result"><img src="http://cdn.steamcommunity.com/economy/image/' . $icon_url . '" /></div>';
						$j++;
						$i++;
					}
				}
			}
			//echo $game_inv[0];
		}
	}
	else{
		echo "false!";
		print_r($_SESSION);
	}
		
	//connect_db();
?>
	</center>
	</div>
	</div>
	
	<center id="have">
	
	<div>
    <div class="results_container" style="padding-bottom: 20px; max-width: 300px; display: inline-block; vertical-align:top;">
		<h3>Your Games</h3>
		<div style="margin-top: 15px; margin-bottom: 0px; height:200px; overflow-y: scroll;">
			<?= $inv_list ?>
		</div>
	</div>
	
	<div class="results_container" style="padding-bottom: 20px; max-width: 300px; display: inline-block; vertical-align:top;">
		<h3>Your Coupons</h3>
		<div style="margin-top: 15px; margin-bottom: 0px; height:200px; overflow-y: scroll;">
			<?= $coupon_list ?>
		</div>
	</div>
	
	<div class="results_container" style="padding-bottom: 20px; max-width: 300px; display: inline-block; vertical-align:top;">
		<h3>Your Team Fortress 2 Items</h3>
		<div style="margin-top: 15px; margin-bottom: 0px; height:200px; overflow-y: scroll;">
			<?= $tf2 ?>
		</div>
	</div>
	
	<div class="results_container" style="padding-bottom: 20px; max-width: 300px; display: inline-block; vertical-align:top;">
		<h3>Your Spiral Knights Items</h3>
		<div style="margin-top: 15px; margin-bottom: 0px; height:200px; overflow-y: scroll;">
			<?= $sk ?>
		</div>
	</div>
	
	<div class="results_container" style="padding-bottom: 20px; max-width: 300px; display: inline-block; vertical-align:top;">
		<h3>Your Portal 2 Items</h3>
		<div style="margin-top: 15px; margin-bottom: 0px; height:200px; overflow-y: scroll;">
			<?= $portal ?>
		</div>
	</div>
	</div>
	<input type="button" value="Continue to Want Offers" onclick="continue_to_want_offers(this);" />
	
	</center>
	
	<div id="want" style="display: none;">
	
	<div class="results_container" style="padding-bottom: 20px;">
	<h3 style="margin-bottom: 10px;">Want Offers</h3>
	<div style="overflow-x: scroll; min-height: 150px; border-spacing: 10px;">
	<center id="want_table">
	</center>
	</div>
	</div>
	
	<div class="results_container" style="padding-bottom: 20px;">
	<h3 style="margin-bottom: 10px;">Additional Note</h3>
		<textarea id="note" style="overflow-x: scroll; width: 95%; height: 150px; border-spacing: 10px; resize:vertical;"></textarea>
	</div>
	
	<div>
	<div class="results_container" style="padding-bottom:0px;">
	<h3>Wanted Add List</h3>
		<div style="float: left; height: 160px; border-right: 1px solid black; padding:10px;" >
			
			<input id="search_item" type="text" autocomplete="off" onkeydown="if (event.keyCode == 13) search_item(document.getElementById('search_item').value);"/><br/>
			<input type="button" value="Search" onclick="search_item(document.getElementById('search_item').value);" />
			
		</div>
		<div style="margin-top: 10px;">
			<div id="aaa" class="links" style="overflow-y: scroll; height: 150px; border-top: 1px solid black; border-bottom: 1px solid black; background-color: #FFFFFF;">
				<center id="search_list">
				</center>
			</div>
		</div>
		<div style="clear: left;"></div>
	</div>
	
	<div align="left" style="min-width: 400px;">
	<input type="button" value="Back to Have Offers" style="margin-left: 20px;" onclick="back_to_trade_offers(this);" /><input type="submit" value="Post Trade" style="float:right; margin-right: 20px;" onclick="post_trade(this);" />
	</div>
	
	</div>
	</div>
    
    
  </body>
</html>
